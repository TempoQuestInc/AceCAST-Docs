

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to Use &mdash; AceCast_Docs  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="About" href="WSV3.html" />
    <link rel="prev" title="Installation" href="Installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> AceCast_Docs
          

          
            
            <img src="_static/AceCast_Logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">AceCast</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="About.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="Releases.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="Requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to Use</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#first-step-running-real-real-exe">First Step: Running Real (real.exe)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#second-step-running-acecast-acecast-exe">Second Step: Running AceCAST (acecast.exe)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scaling-considerations">Scaling Considerations</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">WSV3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="WSV3.html">About</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="External_Links.html">External Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQS.html">Frequenty Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">License Information</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AceCast_Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>How to Use</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/How_to_use.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-use">
<span id="howtouselink"></span><h1>How to Use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h1>
<p>(Under Construction)</p>
<div class="admonition-preprocessing admonition">
<p class="admonition-title">Preprocessing</p>
<p>The role of AceCAST is simply to accelerate the execution of WRF itself on GPUs. AceCAST does not
include any other elements of a typical end-to-end workflow of WRF. This means the user is
responsible for running the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Gathering initialization data</p></li>
<li><p>Running the WRF Preprocessing System (WPS) and real</p>
<ul class="simple">
<li><p>geogrid.exe</p></li>
<li><p>ungrib.exe</p></li>
<li><p>metgrid.exe</p></li>
<li><p>real.exe</p></li>
</ul>
</li>
</ol>
</div></blockquote>
<p>A user can use <em>any WPS version</em> they wish. Since WPS is backwards compatible with WRF, a user
can use the latest version of WPS, and the WPS files required to run real.exe, etc. will not cause
compatiblity issues with AceCAST.</p>
<p><strong>The user is required to transfer the necessary files generated by metgrid.exe (met_em* files)
to the *../AceCASTv1.2/run* directory</strong>. The user is also responsible for runnning real.exe as they
would within a typical WRF workflow. For your convenience, TempoQuest provides a basic <em>real.exe</em>
executable in the <em>../AceCASTv1.2/run</em> directory for host-side execution.</p>
</div>
<div class="admonition-benchmark-recommendation admonition">
<p class="admonition-title">Benchmark Recommendation</p>
<p>It is highly recommended that users run the test cases provided in the <em>../AceCASTv1.2/benchmarks</em>
directory to familiarize themselves with AceCAST. For further information, please refer to the
<a class="reference internal" href="Tools.html#toolslink"><span class="std std-ref">Tools</span></a> page.</p>
</div>
<div class="section" id="first-step-running-real-real-exe">
<h2>First Step: Running Real (real.exe)<a class="headerlink" href="#first-step-running-real-real-exe" title="Permalink to this headline">¶</a></h2>
<p><strong>1A.)</strong> To run <em>real.exe</em>, please make sure you are in the <em>../AceCASTv1.2/run</em> directory where the <em>real.exe</em> executable resides.</p>
<p><strong>1B.)</strong> Ensure you have properly installed the required dependencies
(see <a class="reference internal" href="Installation.html#installationlink"><span class="std std-ref">installation</span></a> for more information) and have set up the corresponding runtime
environment correctly. To ensure a proper runtime environment is created, source the environment script
(<em>env.sh</em>),</p>
<p>Either:</p>
<blockquote>
<div><p><strong>I.</strong> Enter the following in the command line and press enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source ../tqi-build/20.7/env.sh
</pre></div>
</div>
</div></blockquote>
<p>Or:</p>
<blockquote>
<div><p><strong>II.</strong> Copy the <em>env.sh</em> file to the run directory and then source the <em>env.sh</em> script:</p>
<blockquote>
<div><p>Assuming you are in the <em>../AceCASTv1.2/run</em> directory, enter the following in the command line and press enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cp ../tqi-build/20.7/env.sh .
</pre></div>
</div>
<p>Then, enter the following in the command line and press enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source env.sh
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><strong>1C.)</strong> Lastly, run <em>real.exe</em> as you would in a typical WRF workflow by entering the following in the
command line and pressing enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 4 ./real.exe
</pre></div>
</div>
<div class="admonition-please-note admonition">
<p class="admonition-title">Please Note:</p>
<p><em>real.exe</em> generates the required files, wrfinput_d0* and wrfbdy_d01, that are needed to run AceCAST.</p>
</div>
</div>
<div class="section" id="second-step-running-acecast-acecast-exe">
<h2>Second Step: Running AceCAST (acecast.exe)<a class="headerlink" href="#second-step-running-acecast-acecast-exe" title="Permalink to this headline">¶</a></h2>
<p>At this point, it is assumed the user has run the WPS programs and <em>real.exe</em>. It is also assumed the user
is in the <em>../AceCASTv1.2/run</em> directory.</p>
<p><strong>2A.)</strong> First, source the environment script (env.sh). This script will need to be invoked every time a
user logs in. See the earlier, <em>Step One: Running Real (real.exe)</em> on how to do this.</p>
<p><strong>2B.)</strong> Modify the <em>namelist.input</em> file using an editor of your choice to ensure the settings are
correct for your specific case.</p>
<div class="admonition-please-note admonition">
<p class="admonition-title">Please Note:</p>
<p><em>AceCAST uses the same namelist options that are used by WRF with the exception that certain
options are not yet supported. TempoQuest has provided a summary of the supported namelist
settings in the *README.namelist_support</em> file located in the <em>../AceCASTv1.2</em> directory.
TempoQuest has also provided an AceCAST Advisor Script (<em>acecast-advisor.sh</em>) located in
the <em>../AceCAST/run</em> directory to assist users in modifying their namelist settings to
settings that are supported by AceCAST. More information about the supported namelist settings
and the scaling advisor can be found in the <a class="reference internal" href="Tools.html#toolslink"><span class="std std-ref">Tools</span></a> page.</p>
</div>
<p><strong>2C.)</strong> After modifying your <em>namelist.input</em> file, it is good practice to run the AceCAST Advisor Script
to ensure your chosen <em>namelist.input</em> settings are compatible with AceCAST:</p>
<blockquote>
<div><p><strong>I.</strong> Make sure you are in the <em>../AceCASTv1.2/run</em> directory by entering the following in the
command line and pressing enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pwd
</pre></div>
</div>
<p>This command should return something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ../AceCASTv1.2/run
</pre></div>
</div>
<p><strong>II.</strong> Run the <strong>AceCAST Advisor Namelist Support Check</strong> by typing the following in the
command line and pressing enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./acecast-advisor.sh --tool support-check --namelist-file /path/to/file/namelist.input
</pre></div>
</div>
<p>If the namelist.input file being checked uses supported options that <strong>ARE</strong> compatible with AceCAST,
you will see a similar message to the one below printed in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ Support Check Configuration:
  Namelist: ../AceCASTv1.2/run/namelist.input
  AceCAST Version: 1.2
  WRF Compatibility Version: 3.8.1
  NOTE: Namelist options may be determined implicitly if not specified in the given namelist.
  Support Check Tool Success: No unsupported options found - Ok to use namelist for AceCAST
  execution.
</pre></div>
</div>
<p>If the namelist.input file being checked uses unsupported options that <strong>ARE NOT</strong> compatible with
AceCAST**, you will see a similar message to the one below printed in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ Support Check Configuration:
  Namelist: ../AceCASTv1.2/run/namelist.input
  AceCAST Version: 1.2
  WRF Compatibility Version: 3.8.1
  NOTE: Namelist options may be determined implicitly if not specified in the given namelist.

  Support Check Failure: Unsupported option selected for namelist variable mp_physics in
  &amp;physics: mp_physics = 10
  Supported options for namelist variable mp_physics: 0, 1, 6, 8, 28
  Support Check Tool Failure: One or more options found that are not supported by AceCAST.
  Please modify your namelist selections based on the previous &quot;SUPPORT CHECK FAILURE&quot;
  messages and run this check again.
</pre></div>
</div>
</div></blockquote>
<div class="admonition-please-note admonition">
<p class="admonition-title">Please Note:</p>
<p>If a setting is not compatible, you will have to change this setting to a setting that is
compatible, and you will be required to re-run real.exe because any changes in the namelist.input
file will affect the wrfbdy_d01 and wrfinput files. Optionally, you can contact us <a class="reference internal" href="Support.html#supportlink"><span class="std std-ref">Contact us</span></a>
and we can try to implement your specific setting.</p>
</div>
<p><strong>2D.)</strong> After modifying your <em>namelist.input</em> file so it contains supported namelist settings compatible
with AceCAST, it is good practice to run the AceCAST Advisor Script <strong>again</strong> with its Scaling Advisor to see
how many GPUs you should use to run your simulation</p>
<div class="admonition-please-note admonition">
<p class="admonition-title">Please Note:</p>
<p>This script should be run on the intended environment and machine that will be used to run AceCAST
in order for this tool to identify the critical information needed about the user’s GPU
specifications.</p>
</div>
<p>To run the AceCAST Advisor Script with the scaling-advisor option:</p>
<blockquote>
<div><p><strong>I.</strong> Make sure you are in the <strong>../AceCASTv1.2/run</strong> directory (see 2C)</p>
<p><strong>II.</strong> Run the AceCAST Advisor Script with the Scaling Advisor option by entering the
following in the command line and pressing enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./acecast-advisor.sh --tool scaling-advisor --namelist.file /path/to/file/namelist.input
</pre></div>
</div>
<p>This will return a message to the screen that tells you the minimum and maximum number of GPUs
that should be used for your specific simulation, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ AceCAST Scaling Advisor Recommendation:
        Minimum number of GPUs: 1 GPUs
        Maximum number of GPUs: 3 GPUs
Scaling Advisor Tool Finished - Exiting
</pre></div>
</div>
</div></blockquote>
<p><strong>2E.)</strong> Transfer or link your AceCAST license file (<em>acecast-trial.lic</em>) to your
<strong>../AceCASTv1.2/run</strong> directory. The reason you need to do this is because this
license file is checked when AceCAST (<em>acecast.exe</em>) runs to ensure the user has a valid license:</p>
<blockquote>
<div><p><strong>I.</strong> Copy the license file to the ../AceCASTv1.2/run directory.</p>
<p>Or</p>
<p><strong>II.</strong> If you do not want to copy the license file to the ../AceCASTv1.2/run directory,
you can point the <em>RLM_LICENSE</em> environment variable to the location of the license
file by entering the following in the command line and pressing enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export RLM_LICENSE=$HOME//AceCAST/run/acecast-trial.lic
</pre></div>
</div>
</div></blockquote>
<p><strong>2F.)</strong> After you have verified your namelist settings are compatible with AceCAST, and you have a rough
range of the number of GPUs you should use to optimize the time it will take to run your simulation,
you can now run AceCAST.exe.AceCAST.exe uses the Message Passing Interface (MPI) for running on multiple
GPUs just as CPU WRF does for running on multiple CPU cores. <strong>The recommended strategy is to launch one
MPI rank per GPU.</strong> This is typically done using a “wrapper script” (<em>gpu-launch.sh</em>), which is included
in the AceCAST download. This will properly assigns a GPU to each rank using its rank number. The wrapper
script is located in the <em>../AceCASTv1.2/run</em> directory.</p>
<p>Here are some examples of how to run AceCAST using different MPI ranks:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 28%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Rank (# of GPU’s)</p></th>
<th class="head"><p>Nodes</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1 GPU run</p></td>
<td><p>on 1 node</p></td>
<td><p>mpirun -np 1 ./gpu-launch.sh ./acecast.exe</p></td>
</tr>
<tr class="row-odd"><td><p>4 GPU run</p></td>
<td><p>on 1 node (4 GPUs per node)</p></td>
<td><p>mpirun -np 4 ./gpu-launch.sh ./acecast.exe</p></td>
</tr>
<tr class="row-even"><td><p>8 GPU run</p></td>
<td><p>on 2 nodes (4 GPUs per node)</p></td>
<td><p>mpirun -np 8 -npernode 4 ./gpu-launch.sh ./acecast.exe</p></td>
</tr>
</tbody>
</table>
<p>To recap, after invoking a command to run AceCAST, AceCAST will run and the acecast.exe executable will
perform a check for supported namelist options at runtime. If there is an unsupported namelist option
within your namelist.input file, AceCAST will automatically terminate the job. Additionally, the acecast.exe
executable will check the license file to ensure the user’s license is active/valid. At the end of a
successful AceCAST run, it will generate output in the rsl.out and rsl.error files similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Checking</span> <span class="n">out</span> <span class="n">AceCAST</span> <span class="n">Licenses</span><span class="o">.</span>
<span class="n">RLM</span> <span class="n">license</span> <span class="n">checkout</span><span class="p">:</span>
<span class="o">------------------------</span>
<span class="n">Product</span><span class="p">:</span> <span class="n">acecast</span>
<span class="n">Version</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Count</span><span class="p">:</span>   <span class="mi">4</span>
<span class="o">------------------------</span>
<span class="n">Successfully</span> <span class="n">checked</span> <span class="n">out</span> <span class="n">licenses</span><span class="o">.</span>
<span class="o">...</span>
<span class="n">SUPPORT</span> <span class="n">CHECK</span> <span class="n">SUCCESS</span><span class="p">:</span> <span class="n">Valid</span> <span class="n">namelist</span> <span class="n">configuration</span> <span class="k">for</span> <span class="n">AceCAST</span> <span class="n">execution</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="scaling-considerations">
<h2>Scaling Considerations<a class="headerlink" href="#scaling-considerations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Although GPUs typically offer far more performance potential than typical CPUs, they do
require relatively large parallel workloads to efficiently utilize the thousands of CUDA
execution cores available to each GPU. This means that it is not very efficient to use more
GPUs than is necessary for a given domain’s grid size.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="WSV3.html" class="btn btn-neutral float-right" title="About" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, TempoQuest.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>